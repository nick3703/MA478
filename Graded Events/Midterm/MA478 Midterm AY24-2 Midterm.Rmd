---
output:
  pdf_document:
    extra_dependencies: ["xcolor"]
  html_document: default
editor_options:
  markdown:
    wrap: 100
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
```

\newcommand{\sol}[1]{\color{teal}  #1 \color{black}} 

\textbf{MA478 Generalized Linear Models (Spring 2024)} \hspace{1.5in} \textbf{Name:} \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ \textbf{Midterm - 150 points}

\vspace{.25in}

\textbf{\underline{READ THESE INSTRUCTIONS CAREFULLY BEFORE YOU BEGIN.}}

```{=tex}
\begin{enumerate}
    \item This exam consists of this cover page and 8 pages of questions (total of 9 pages) worth a total of 150 points. You will have 75 minutes to complete this exam. 
    \item You are authorized to use your course notes and R/Rstudio (blank scripts only). You may NOT use any resources that are not on the authorized reference list, including computers, phones, the Internet, your textbook, and your classmates.
    \item All work written on this exam will be graded unless it is clearly marked through.  To receive full credit for your answer, you must show ALL mathematical work and provide explanations within the context of the associated research question. 
    \item Clearly indicate your final answer for questions that require calculations and \textbf{round all numbers to at least three significant digits}.
    \item Use a blank continuation sheet and clearly identify that the problem is continued both on the exam and on the continuation sheet.  Use one continuation sheet per problem continued.  Be sure to put your name on each continuation sheet.
    \item Cadets are \textbf{not} authorized to discuss the content, structure, or any other information about this exam until this exam has been released from academic security. Discussion includes all forms of written, electronic, and verbal communication. 
    \item Honor Acknowledgement Statement:  Sign and date the statement below when you have finished the exam and are ready to submit it for grading.
\end{enumerate}
```
"I did not use any sources nor did I receive any assistance while completing this exam. I will not discuss this exam with anyone until it is released from academic security on \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ at \_\_\_\_\_\_\_\_ hours."

\vspace{.5in}

\rule{1.7 in}{.5pt}\hspace{.5in}\rule{1.7 in}{.5pt}\hspace{.5in}\rule{1.7 in}{.5pt}

Printed Name of Cadet\hspace{.75 in} Signature of Cadet \hspace{.95 in} Time and Date Signed

\vspace{.25in}

```{=tex}
\begin{table}[hb]
\centering
\LARGE
\begin{tabular}{|l|c|c|c|c|}
\hline
Question & 1  & 2  & 3  & Total \\ \hline
Points   & 55 & 70 & 25 & 150   \\ \hline
Total    &    &    &    &       \\ \hline
\end{tabular}
\normalsize
\end{table}
```


```{r, echo=FALSE}
chi_dat <- read.csv("https://raw.githubusercontent.com/nick3703/Chicago-Data/master/crime.csv")
pop <- read.csv("https://raw.githubusercontent.com/nick3703/Chicago-Data/master/pop.csv")
unemp <- read.csv("https://raw.githubusercontent.com/nick3703/Chicago-Data/master/unemp.csv")
wealth <- read.csv("https://raw.githubusercontent.com/nick3703/Chicago-Data/master/wealth.csv")


chi_df <- data.frame(burglaries=chi_dat$count.201001,population = pop$x+1,
                     unemployment = unemp$x,
                     wealth = wealth$x)

```

\newpage

# Part 1 (55 pts)
<!-- (Write a fitted GLM from summary output) -->

> The Donner Party were a group of emigrants moving to start a new life in California. But between 1846 and 1847, 45 out of the 87 people on the wagon train would die from sickness, starvation, murder, and cannibalism. You conduct an analysis on the data and get the following output:


```{r,warning=FALSE,message=FALSE}
library(tidyverse)
library(faraway)

donner_dat <- read.table("https://dnett.github.io/S510/Donner.txt",header=T)

donner_dat <- donner_dat %>% mutate(survive=ifelse(status=="DIED",0,1))

our_glm <- glm(survive~sex+age,data=donner_dat,
               family="binomial")


summary(our_glm)




```

### P1.1 (20) Write the complete estimated regression equation of the model using the summary output ensuring you have properly identified the function, linear predictor and distribution of the data.

\newpage

You next run the model:

```{r}

our_glm2 <- glm(survive~sex+age+sex:age,data=donner_dat,family="binomial")


summary(our_glm2)

```

### P1.2 (10) Based on all the information given, which model would you prefer and why? To answer this question, perform a statistical test, ensure you give the test statistic and the distribution of that test statistic.

\vspace{2in}

### P1.3 (5)  According to `our_glm` how does the person's age impact the odds that they survived?

\newpage

### P1.4 (10) Assuming you wanted to compare `our_glm` with a model that was not nested explain how you could do this WITHOUT relying on AIC or BIC. 

\vspace{4.in}

### P1.5 (10) Your officemate states that you should conduct a goodness of fit test by testing the deviance of the model and runs the test:

```{r}
1-pchisq(51.256,41)

```

Is this a correct approach? If no, provide an alternative approach. If it is a correct approach provide a conclusion. Note here if you provide an alternative approach you do not have to actually carry out the test.


\newpage

# Part 2 (70 pts)


You are interested in exploring factors that impact the number of burglaries in Chicago so you collect data on 552 different city blocks and count the number of burglaries that occur over a month. You also collect data on the percent of the population that is unemployed and the average salaries on the block. In this class we have discussed at least four different models that could be used to analyze this data. In particular, you could use a negative binomial distribution, a Poisson distribution, a Quasi-Poisson, or a zero inflated Poisson. 

### P2.1 (30) Discuss how you would go about picking between these four models. Give examples of when each of them would be appropriate.

\newpage


### P2.2 (15) Your friend decides to fit the following model, write out the model that they are fitting and explain what issues they may have fitting this model:


```{r,eval=FALSE}
chi_df <- read.csv("chi_burg.csv")

chi_mod <- glm(burglaries ~ unemployment + wealth, offset=log(population),
            family=poisson(link="identity"),
            data=chi_df)

```



\newpage

### P2.3(15) You fit the model below and run the below lines of code to assess your model. Explain what you are checking in the model, what your findings suggest, and what you would do next.

```{r}


chi_mod <- glm(burglaries ~ unemployment + wealth, offset=log(population),
            family=poisson,
            data=chi_df)

sum(residuals(chi_mod,type="pearson")^2)/chi_mod$df.residual

1-pchisq(deviance(chi_mod),df.residual(chi_mod))

```

\newpage

### P2.3(10) Your roommate has heard about quasi-Poisson models and decides to a quasi-Poisson model to the data, they argue that they can use AIC to compare their model to your Poisson regression model. Are they correct? Why/why not? 

\newpage

### P3 (25 Pts) For the distribution listed below:

```{=tex}
\begin{itemize}
  \item Show that it is part of the exponential dispersion family
  \item Identify the canonical parameter $\theta$
  \item Show that the expected value is $\mu$ and find the variance function (in terms of $\mu$)
\end{itemize}


$$f(y|\mu,\lambda) = \left(\frac{\lambda}{2 \pi y^3}\right)^{1/2}\exp\left(\frac{\lambda}{2\mu^2}\frac{(y-\mu)^2}{y}\right)$$


```


\textit{HINT:} Let $\phi = \frac{1}{\lambda}$ and $b(\theta)= - \sqrt{-2 \theta}$
